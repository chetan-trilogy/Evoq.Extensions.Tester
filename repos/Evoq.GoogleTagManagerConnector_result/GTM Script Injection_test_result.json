{
  "metadata": {
    "extension_name": "Evoq.GoogleTagManagerConnector",
    "extension_type": "Connector",
    "feature_name": "GTM Script Injection",
    "feature_description": "Injects Google Tag Manager JavaScript code into page headers for tracking and analytics",
    "feature_priority": "Top",
    "test_date": "2026-01-09T15:26:00Z",
    "tester": "Claude"
  },
  "test_scenarios": [
    {
      "scenario_name": "Container ID validation rejects invalid IDs",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigated to Settings > Connectors",
          "expected": "Connectors page loads with Google Tag Manager option",
          "actual": "Connectors page loaded successfully with Google Tag Manager showing 'Connect' button",
          "screenshot": "GTM_Script_Injection_step01_connectors_page.png"
        },
        {
          "step_number": 2,
          "action": "Clicked Connect on Google Tag Manager to open configuration",
          "expected": "GTM configuration form opens with Container ID field",
          "actual": "Configuration form opened with Container ID text field and GA checkbox option",
          "screenshot": "GTM_Script_Injection_step02_gtm_config_form.png"
        },
        {
          "step_number": 3,
          "action": "Entered invalid container ID 'GTM-INVALID' and clicked Save",
          "expected": "Validation error should appear rejecting the invalid container",
          "actual": "Error message displayed: 'The Container Id is invalid or container hasn't been published yet.'",
          "screenshot": "GTM_Script_Injection_step03_validation_error.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify no script injection when container ID is empty",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Cleared the Container ID field (set to empty) and clicked Save",
          "expected": "Empty container ID should be accepted and saved",
          "actual": "Success message 'Item successfully saved' displayed",
          "screenshot": "GTM_Script_Injection_step04_empty_container_saved.png"
        },
        {
          "step_number": 2,
          "action": "Navigated to home page and checked page head for GTM script using JavaScript evaluation",
          "expected": "No GTM script should be present in the page head when container ID is empty",
          "actual": "JavaScript evaluation confirmed 'No GTM script found in head' - as expected",
          "screenshot": "GTM_Script_Injection_step05_no_script_empty_container.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify GTM script appears in page head when container configured",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Attempted to configure multiple GTM container IDs (GTM-NDJHP9, GTM-5GWG5X, GTM-PRFLJPV, GTM-T9GFBX, GTM-TJGCRGP)",
          "expected": "A valid container ID should pass validation and save successfully",
          "actual": "All attempted container IDs failed validation with error: 'The Container Id is invalid or container hasn't been published yet.'",
          "screenshot": "GTM_Script_Injection_step06_validation_rejection.png"
        }
      ],
      "issues": [
        "Cannot test actual script injection without a real, valid GTM container ID",
        "The connector validates container IDs by calling Google's GTM JS URL (https://www.googletagmanager.com/gtm.js?id={containerId}) and checking for HTTP 200 response",
        "Without access to a real published GTM container, this test scenario cannot be completed via UI"
      ]
    },
    {
      "scenario_name": "Verify container ID is correctly substituted in script",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Attempted to configure a valid container to verify ID substitution",
          "expected": "Container ID should appear in the injected GTM script",
          "actual": "Cannot test - no valid container ID available that passes validation",
          "screenshot": "GTM_Script_Injection_step06_validation_rejection.png"
        }
      ],
      "issues": [
        "Test blocked by container ID validation - requires real GTM container",
        "Code review confirms correct implementation: scriptContent.Replace('[CONTAINERID]', containerId) at TagManagerModule.cs:80"
      ]
    },
    {
      "scenario_name": "Verify script only injects on CDefault pages",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Reviewed code to understand page type restriction",
          "expected": "Script should only inject on CDefault page type",
          "actual": "Cannot UI test without valid container; Code review confirms restriction at TagManagerModule.cs:46: 'if (!(page is CDefault)) return;'",
          "screenshot": "GTM_Script_Injection_step06_validation_rejection.png"
        }
      ],
      "issues": [
        "Cannot test via UI without valid GTM container ID",
        "Code implementation appears correct based on review"
      ]
    },
    {
      "scenario_name": "Test script injection after configuration changes",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Attempted to test configuration change behavior",
          "expected": "Script injection should update when container ID changes",
          "actual": "Cannot test - no valid container ID available",
          "screenshot": "GTM_Script_Injection_step06_validation_rejection.png"
        }
      ],
      "issues": [
        "Test blocked by container ID validation - requires real GTM container"
      ]
    }
  ],
  "observations": [
    "Container ID validation works correctly by calling Google's GTM JS endpoint to verify the container exists and is published",
    "Empty container ID is properly handled - no script injection occurs when container ID is empty (verified via JavaScript evaluation)",
    "The validation error message 'The Container Id is invalid or container hasn't been published yet' is clear and helpful",
    "Code review of TagManagerModule.cs confirms correct implementation: HttpModule registers PreRender event, only injects on CDefault pages, checks for non-empty container ID, uses caching for script template, and substitutes placeholders correctly",
    "The 'This GTM container has already been configured to add the Google Analytics Script' checkbox option suggests integration with GA functionality",
    "Script template is stored in GoogleTagManager.config and uses placeholders: [CONTAINERID], [USETAGMANAGERFORGA], [DATALAYER_INIT]",
    "Testing actual script injection requires access to a real, published GTM container ID - this is an environmental limitation rather than a feature defect"
  ],
  "summary": {
    "total_scenarios": 6,
    "passed": 2,
    "failed": 4,
    "pass_rate": "33%"
  }
}
