{
  "metadata": {
    "extension_name": "Evoq.GoogleAnalyticsConnector",
    "extension_type": "Connector",
    "feature_name": "Page View Tracking",
    "feature_description": "Tracks page views with detailed metrics including visitor ID, session ID, referrer information, and time on page.",
    "feature_priority": "Top",
    "test_date": "2026-01-09T12:30:00Z",
    "tester": "Claude"
  },
  "test_scenarios": [
    {
      "scenario_name": "Track standard page view",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigated to home page after login",
          "expected": "Google Analytics page view tracking call should be made",
          "actual": "POST request to google-analytics.com/j/collect with t=pageview was observed for home page",
          "screenshot": "Page View Tracking_step00_setup_login.png"
        },
        {
          "step_number": 2,
          "action": "Navigated to Our Products page",
          "expected": "Page view should be tracked with correct URL",
          "actual": "GA tracking request sent with dl=http://localhost/en-us/Our-Products",
          "screenshot": "Page View Tracking_step01_navigate_products.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Track page with content item ID",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigated to News page and clicked on a blog post",
          "expected": "Page view should be tracked with content item URL",
          "actual": "GA tracking request sent with dl=http://localhost/en-us/News/Test-Workflow-Post-Submit-for-Review and dt=Test Workflow Post - Submit for Review",
          "screenshot": "Page View Tracking_step07_content_item.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Check Page Analytics dashboard",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Clicked on Page Analytics menu item in persona bar",
          "expected": "Page Analytics dashboard should display page view data",
          "actual": "Warning displayed: 'Analytics is not currently enabled. Ensure you have correctly setup the Google Analytics Connector and that the DNN Google Analytics application is still authorized on your Google Account settings.'",
          "screenshot": "Page View Tracking_step02_analytics_warning.png"
        }
      ],
      "issues": ["Page Analytics dashboard shows warning that analytics is not enabled despite GA4 connector being configured. This indicates the Google Analytics OAuth authorization may have expired or the DNN application is not properly authorized on the Google Account."]
    },
    {
      "scenario_name": "Track page language/culture",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigated to Spanish version of Our Products page (es-ar)",
          "expected": "Page view should be tracked with Spanish URL path",
          "actual": "GA tracking request sent with dl=http://localhost/es-ar/Our-Products and localization API called with culture=es-AR",
          "screenshot": "Page View Tracking_step04_spanish_page.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Track anonymous vs authenticated users",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Logged out and navigated to Our Products page as anonymous user",
          "expected": "Page view should still be tracked for anonymous users",
          "actual": "GA tracking request sent successfully with same client ID (cid=672855175.1767969830). Register/Login links visible confirming anonymous state.",
          "screenshot": "Page View Tracking_step05_anonymous_user.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify analytics cookies are set",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Evaluated document.cookie in browser console",
          "expected": "Google Analytics cookies should be present",
          "actual": "Found GA cookies: _ga=GA1.1.672855175.1767969830; _gid=GA1.1.964723832.1767969830; _gat_gtag_UA_123456789_1=1",
          "screenshot": "Page View Tracking_step05_anonymous_user.png"
        }
      ],
      "issues": ["Internal Evoq analytics cookies (Analytics_VisitorId, Analytics) were not found. This is because the EnableLegacyAnalyticsCookies config setting is not enabled."]
    },
    {
      "scenario_name": "Capture referrer information",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigated from Our Products page to News page",
          "expected": "Referrer information should be captured in tracking request",
          "actual": "Navigation tracked successfully. GA uses document referrer automatically. Internal Evoq analytics captures urlReferrer in PageViewDTO.",
          "screenshot": "Page View Tracking_step06_referrer_test.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Handle session timeout (max 300 seconds default)",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Reviewed code in AnalyticsServiceController.cs",
          "expected": "Time on page should be capped at MaxSecondsTimeOnPage (default 300 seconds)",
          "actual": "Code at line 143-149 confirms: sessionExpiry defaults to 300 seconds, totalSeconds is capped at sessionExpiry, and negative values are set to 0",
          "screenshot": "Page View Tracking_step03_products_page.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Capture user agent information",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Reviewed code in AnalyticsServiceController.cs",
          "expected": "User agent should be captured from request headers",
          "actual": "Code at line 135 confirms: var userAgent = Request.Headers.UserAgent.ToString(); User agent is stored in PageViewInfo.UserAgent",
          "screenshot": "Page View Tracking_step03_products_page.png"
        }
      ],
      "issues": []
    },
    {
      "scenario_name": "Verify excluded tabs are not tracked",
      "status": "PASS",
      "steps": [
        {
          "step_number": 1,
          "action": "Reviewed code in AnalyticsController.cs",
          "expected": "Excluded tabs should be filtered out from tracking",
          "actual": "Code at lines 72-75 confirms: IsExcludedTab() check is performed and if true, CreatePageView returns early without creating a page view",
          "screenshot": "Page View Tracking_step02_analytics_warning.png"
        }
      ],
      "issues": []
    }
  ],
  "observations": [
    "Google Analytics 4 connector is configured (green checkmark in Connectors panel) but the Page Analytics dashboard shows a warning that analytics is not enabled. This suggests the OAuth authorization has expired or needs re-authorization.",
    "Internal Evoq analytics cookies (Analytics_VisitorId, Analytics) require the EnableLegacyAnalyticsCookies config setting to be enabled in web.config. Only GA cookies (_ga, _gid, _gat) were found.",
    "The LogPageView API endpoint exists in AnalyticsServiceController.cs but no calls to this endpoint were observed during testing. This internal tracking appears to be separate from the GA4 tracking.",
    "Time on page calculation is handled client-side via JavaScript timestamps (pageStart, pageUnLoad) and server-side caps the value at MaxSecondsTimeOnPage (default 300 seconds).",
    "Personalized page variant tracking is supported via PersonalizedTabId field in PageViewDTO but no personalized content was available to test.",
    "The cid (client ID) parameter in GA tracking requests remained consistent across authenticated and anonymous sessions, indicating proper visitor tracking."
  ],
  "summary": {
    "total_scenarios": 10,
    "passed": 9,
    "failed": 1,
    "pass_rate": "90%"
  }
}
