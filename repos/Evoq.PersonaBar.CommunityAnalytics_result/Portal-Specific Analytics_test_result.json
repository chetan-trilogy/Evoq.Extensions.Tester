{
  "metadata": {
    "extension_name": "Evoq.PersonaBar.CommunityAnalytics",
    "extension_type": "PersonaBar Module",
    "feature_name": "Portal-Specific Analytics",
    "feature_description": "Isolation of analytics data per portal in multi-portal installations",
    "feature_priority": "High",
    "test_date": "2026-01-09T21:49:00Z",
    "tester": "Claude"
  },
  "test_scenarios": [
    {
      "scenario_name": "Verify portal data isolation",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Logged in as host user (SuperUser Account) to main portal",
          "expected": "Successfully logged in and PersonaBar accessible",
          "actual": "Successfully logged in, PersonaBar visible with Dashboard menu",
          "screenshot": "Portal-Specific_Analytics_step00_login_confirmed.png"
        },
        {
          "step_number": 2,
          "action": "Navigated to Dashboard > Community Analytics in PersonaBar",
          "expected": "Community Analytics panel should load showing portal-specific data",
          "actual": "Community Analytics panel failed to load - blank white panel displayed due to JavaScript error: TypeError: utility.serializeCustomDate is not a function",
          "screenshot": "Portal-Specific_Analytics_step02_community_analytics_panel.png"
        }
      ],
      "issues": [
        "Community Analytics panel fails to initialize due to JavaScript error: TypeError: utility.serializeCustomDate is not a function at dashboardClass.init",
        "Cannot verify portal data isolation because the analytics panel does not render"
      ]
    },
    {
      "scenario_name": "Test cross-portal data prevention",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Verified multiple portals exist - navigated to Manage > Sites",
          "expected": "Multiple portals should be listed",
          "actual": "Found 2 portals: 'My Website' (18 users, 75 pages) and 'Test Portal' (1 user, 28 pages)",
          "screenshot": "Portal-Specific_Analytics_step04_sites_list.png"
        },
        {
          "step_number": 2,
          "action": "Attempted to access Community Analytics on main portal to verify data isolation",
          "expected": "Should show analytics data specific to current portal only",
          "actual": "Community Analytics panel failed to load - JavaScript error prevents testing cross-portal data prevention",
          "screenshot": "Portal-Specific_Analytics_step02_community_analytics_panel.png"
        }
      ],
      "issues": [
        "Cannot test cross-portal data prevention because Community Analytics panel fails to load",
        "JavaScript error: utility.serializeCustomDate is not a function"
      ]
    },
    {
      "scenario_name": "Validate portal ID handling",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Reviewed source code - Services/CommunityAnalyticsController.cs uses EffectivePortalId property",
          "expected": "Code should properly use portal ID for data isolation",
          "actual": "Code review confirmed: EffectivePortalId is passed to all analytics API methods (GetDashboardInfo, GetTagStats, etc.) ensuring portal-specific data retrieval",
          "screenshot": "Portal-Specific_Analytics_step01_community_analytics_nav.png"
        },
        {
          "step_number": 2,
          "action": "Attempted to verify portal ID handling through UI",
          "expected": "Community Analytics should load and display data for current portal",
          "actual": "Cannot verify UI behavior - panel fails to load due to JavaScript error in social-dashboard-combined-instance.js",
          "screenshot": "Portal-Specific_Analytics_step02_community_analytics_panel.png"
        }
      ],
      "issues": [
        "Code implementation appears correct but cannot be verified through UI due to JavaScript error",
        "The EffectivePortalId logic in CommunityAnalyticsController.cs (lines 33-45) correctly calculates portal ID"
      ]
    },
    {
      "scenario_name": "Test with portal groups",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Navigated to Manage > Sites and checked Site Groups tab",
          "expected": "Should be able to view and test portal groups",
          "actual": "Site Groups tab is visible in the Sites panel",
          "screenshot": "Portal-Specific_Analytics_step04_sites_list.png"
        },
        {
          "step_number": 2,
          "action": "Attempted to test analytics behavior with portal groups",
          "expected": "Analytics should respect portal group boundaries",
          "actual": "Cannot test portal group analytics behavior - Community Analytics panel fails to load",
          "screenshot": "Portal-Specific_Analytics_step02_community_analytics_panel.png"
        }
      ],
      "issues": [
        "Cannot test portal groups functionality because Community Analytics panel is broken",
        "JavaScript initialization error prevents any analytics testing"
      ]
    },
    {
      "scenario_name": "Verify host user access",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "Logged in as host user (SuperUser Account)",
          "expected": "Host user should have access to Community Analytics across all portals",
          "actual": "Host user can navigate to Dashboard menu and see Community Analytics option",
          "screenshot": "Portal-Specific_Analytics_step01_community_analytics_nav.png"
        },
        {
          "step_number": 2,
          "action": "Host user clicked on Community Analytics",
          "expected": "Community Analytics panel should load showing comprehensive analytics",
          "actual": "Panel fails to load - JavaScript error prevents host user from viewing analytics",
          "screenshot": "Portal-Specific_Analytics_step02_community_analytics_panel.png"
        }
      ],
      "issues": [
        "Host user has navigation access but cannot view Community Analytics due to JavaScript error",
        "Components/CommunityAnalyticsController.cs code (lines 55-62) shows host users should get combined dashboard view"
      ]
    },
    {
      "scenario_name": "Test portal switching",
      "status": "FAIL",
      "steps": [
        {
          "step_number": 1,
          "action": "From main portal, navigated to Manage > Sites and clicked 'View Site' for Test Portal",
          "expected": "Should switch to Test Portal context",
          "actual": "Successfully switched to Test Portal - new tab opened with URL http://localhost:8081/testportal",
          "screenshot": "Portal-Specific_Analytics_step05_test_portal.png"
        },
        {
          "step_number": 2,
          "action": "On Test Portal, clicked Dashboard menu",
          "expected": "Should show Community Analytics option and load portal-specific data",
          "actual": "Dashboard opens Site Analytics directly with Google Analytics warning. Community Analytics submenu not visible on this portal.",
          "screenshot": "Portal-Specific_Analytics_step07_test_portal_dashboard.png"
        },
        {
          "step_number": 3,
          "action": "Attempted to access Community Analytics on Test Portal",
          "expected": "Should show Test Portal-specific analytics data",
          "actual": "Site Analytics panel shows with warning 'Analytics is not currently enabled'. Community Analytics option not accessible from Dashboard menu on Test Portal.",
          "screenshot": "Portal-Specific_Analytics_step06_test_portal_site_analytics.png"
        }
      ],
      "issues": [
        "Portal switching navigation works correctly",
        "Community Analytics is not accessible on Test Portal - only Site Analytics shows",
        "Main portal shows Community Analytics option but it fails to load"
      ]
    }
  ],
  "observations": [
    "Code review confirms portal-specific analytics is properly implemented in Services/CommunityAnalyticsController.cs using EffectivePortalId property (lines 33-45)",
    "All API methods (GetDashboardInfo, GetTagStats, GetPopularContent, etc.) correctly pass EffectivePortalId as first parameter",
    "Components/CommunityAnalyticsController.cs (lines 41-62) implements role-based access control for host/admin users",
    "The JavaScript error 'utility.serializeCustomDate is not a function' in social-dashboard-combined-instance.js:1025 prevents the Community Analytics panel from initializing",
    "Site Analytics panel works correctly on both portals, suggesting the issue is specific to Community Analytics module",
    "Multiple portals are configured: 'My Website' (Portal 0) and 'Test Portal' (Portal 1) - both accessible via Manage > Sites"
  ],
  "summary": {
    "total_scenarios": 6,
    "passed": 0,
    "failed": 6,
    "pass_rate": "0%"
  }
}
